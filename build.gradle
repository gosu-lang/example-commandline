import org.apache.tools.ant.taskdefs.condition.Os

def WINDOWS = Os.isFamily(Os.FAMILY_WINDOWS)

//check java version at initialization time
def javaVersion = Double.valueOf(System.getProperty('java.specification.version'))
if(javaVersion < Double.valueOf((String) project.minimumJavaVersion)) {
    throw new InvalidUserDataException("Java version $project.minimumJavaVersion or higher is required, exiting") //effectively exits the script
} else {
    println "Java version $project.minimumJavaVersion or later was found."
}

//dependencies {
//    classpath 'org.gosu-lang.gosu:gosu:1.8.1'
//}

task inlineScript(type: Exec) {//(dependsOn: init) {

    def theCommand
    def args = ['-e', '\'print(\\"Hello world!\\")\'']

    if(WINDOWS) {
        theCommand = ['cmd', '/c', 'gosu.bat']
        theCommand.addAll(args)
    } else {
        theCommand = ['./gosu']
        theCommand.addAll(args)
    }

    commandLine = theCommand

    //store the output instead of printing to the console:
    standardOutput = new ByteArrayOutputStream()

    ext.output = {
        return standardOutput.toString()
    }
}
